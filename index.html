<!DOCTYPE html>
<html>
<head>
    <title>Swap on Uniswap</title>
    <style>
        body {
            background-color: transparent;
            color: #fff;
            font-family: Arial, sans-serif;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            padding: 0;
        }

        h1 {
            margin-top: 50px;
        }

        .button {
            display: inline-block;
            margin-top: 30px;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            background-color: #000;
            color: #fff;
            border: none;
        }

        .button-black {
            background-color: #000;
        }

        .button-white {
            background-color: #000;
        }

        #ethAmount {
            display: none;
            margin-top: 20px;
            padding: 10px;
            border: 2px solid #000;
            border-radius: 5px;
            font-size: 18px;
            text-align: center;
            background-color: transparent;
            color: #000;
        }

        #swapButton {
            display: none;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>Swap on Uniswap</h1>

    <button id="connectButton" class="button button-black">Connect Wallet</button>

    <input type="number" id="ethAmount" min="0" step="0.01" placeholder="Enter Ethereum Amount">

    <button id="swapButton" class="button button-white">Swap</button>

    <script src="https://cdn.ethers.io/lib/ethers-5.4.umd.min.js"></script>
    <script>
    const connectButton = document.getElementById('connectButton');
    const ethAmountInput = document.getElementById('ethAmount');
    const swapButton = document.getElementById('swapButton');
    let provider;
    let signer;
    let uniswapRouter;
    const tokenAddress = '0x6982508145454Ce325dDbE47a25d4ec3d2311933';
    const uniswapRouterAddress = '0x5C69bEe701ef814a2B6a3EDD4B1652CB9cc5aA6f';

async function checkAndApproveToken(amountIn) {
    const tokenContract = new ethers.Contract(
        tokenAddress,
        ['function allowance(address owner, address spender) external view returns (uint256)'],
        signer
    );

    const allowance = await tokenContract.allowance(signer.getAddress(), uniswapRouter.address);

    if (allowance.lt(amountIn)) {
        const approveTx = await tokenContract.approve(uniswapRouter.address, ethers.constants.MaxUint256);
        await approveTx.wait();
    }
}

    async function connectWallet() {
        try {
            if (typeof window.ethereum !== 'undefined') {
                await window.ethereum.request({ method: 'eth_requestAccounts' });
                provider = new ethers.providers.Web3Provider(window.ethereum);
                signer = provider.getSigner();
                uniswapRouter = new ethers.Contract(
                    uniswapRouterAddress,
                    [
                        'function swapExactETHForTokens(uint256, address[], address, uint256) payable returns (uint256[] memory)',
                        'function getAmountsOut(uint256, address[]) view returns (uint256[] memory)'
                    ],
                    signer
                );
            } else {
                throw new Error('Metamask extension not detected');
            }
        } catch (error) {
            console.error(error);
        }
    }

    // Function to handle the click event of the Connect Wallet button
    connectButton.addEventListener('click', () => {
        connectWallet()
            .then(() => {
                connectButton.style.display = 'none';
                ethAmountInput.style.display = 'block';
                swapButton.style.display = 'block';
            })
            .catch(error => {
                console.error(error);
            });
    });

async function executeSwap() {
    const ethAmount = ethAmountInput.value;
    const amountIn = ethers.utils.parseEther(ethAmount);
    const path = [ethers.constants.AddressZero, tokenAddress];
    const deadline = Math.floor(Date.now() / 1000) + 60 * 20; // 20 minutes from now

    await checkAndApproveToken(amountIn);

    // Execute the swap
    const overrides = {
        value: amountIn,
        gasLimit: 2000000,
    };

    try {
        const tx = await uniswapRouter.swapExactETHForTokens(
            ethers.constants.Zero,
            path,
            signer.getAddress(),
            deadline,
            overrides
        );
        
        await tx.wait(); // Wait for the transaction to be mined

        alert('Swap executed successfully!');
    } catch (error) {
        console.error(error);
        alert('Error executing swap');
    }
}


    // Function to handle the click event of the Swap button
    swapButton.addEventListener('click', () => {
        executeSwap()
            .catch(error => {
                console.error(error);
            });
    });
</script>
</body>
</html>
