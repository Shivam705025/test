<!DOCTYPE html>
<html>
  <head>
    <title>Crypto Wallet</title>
    <link rel="stylesheet" href="style.css" />
	  <style>
	       body {
  font-family: Arial, sans-serif;
  margin: 0;
}

h1 {
  text-align: center;
  margin-bottom: 20px;
}

h2 {
  margin-top: 30px;
  margin-bottom: 10px;
}

label {
  display: block;
  margin-top: 10px;
  margin-bottom: 5px;
}

input[type="text"],
input[type="number"] {
  display: block;
  margin-bottom: 10px;
  padding: 5px;
  border: 1px solid #ccc;
  border-radius: 3px;
  width: 100%;
  box-sizing: border-box;
}

button {
  padding: 10px;
  background-color: #008000;
  color: #fff;
  border: none;
  border-radius: 3px;
  cursor: pointer;
}

button:hover {
  background-color: #006400;
}

#account-section,
#send-section,
#receive-section,
#history-section {
  margin: 20px auto;
  max-width: 600px;
  padding: 20px;
  border: 1px solid #ccc;
  border-radius: 5px;
}

	  </style>
	  
	  <script>
	     // Define a list of accounts
let accounts = [];

// Function to create a new account
function createAccount() {
    // Get the name of the new account
    const name = document.getElementById("new-account-name").value;

    // Generate a new private key and address for the account
    const { privateKey, address } = generateKeyPair();

    // Create a new account object with the name, private key, and address
    const account = {
        name,
        privateKey,
        address,
        balance: 0,
        transactions: []
    };

    // Add the account to the list of accounts
    accounts.push(account);

    // Update the accounts table
    updateAccountsTable();

    // Clear the input field
    document.getElementById("new-account-name").value = "";
}

// Function to generate a new private key and address
function generateKeyPair() {
    // Use the elliptic library to generate a new key pair
    const ec = new elliptic.ec("secp256k1");
    const keyPair = ec.genKeyPair();

    // Convert the private key to a hex string and the public key to an address
    const privateKey = keyPair.getPrivate("hex");
    const publicKey = keyPair.getPublic("hex");
    const address = getAddressFromPublicKey(publicKey);

    // Return the private key and address
    return { privateKey, address };
}

// Function to get the address from a public key
function getAddressFromPublicKey(publicKey) {
    // Use the sha256 and ripemd160 libraries to hash the public key and create a checksum
    const publicKeyHash = sha256(Buffer.from(publicKey, "hex"));
    const checksum = ripemd160(publicKeyHash);

    // Add the version byte (0x00 for mainnet) to the front of the checksum
    const versionChecksum = Buffer.concat([Buffer.from("00", "hex"), checksum]);

    // Use base58check encoding to convert the version + checksum to an address
    const address = base58check.encode(versionChecksum);

    // Return the address
    return address;
}

// Function to update the accounts table
function updateAccountsTable() {
    // Get the table body element
    const tableBody = document.getElementById("accounts-table-body");

    // Clear the table body
    tableBody.innerHTML = "";

    // Loop through the accounts and add a row for each one
    for (const account of accounts) {
        // Create a new table row
        const row = document.createElement("tr");

        // Add a cell for the account name
        const nameCell = document.createElement("td");
        nameCell.innerText = account.name;
        row.appendChild(nameCell);

        // Add a cell for the account balance
        const balanceCell = document.createElement("td");
        balanceCell.innerText = account.balance;
        row.appendChild(balanceCell);

        // Add the row to the table body
        tableBody.appendChild(row);
    }

    // Update the "from account" dropdown in the send transaction section
    updateFromAccountDropdown();
}

// Function to update the "from account" dropdown in the send transaction section
// Function to update the "from" account dropdown with the available accounts
function updateFromAccountDropdown() {
  const dropdown = document.getElementById("from-account");
  dropdown.innerHTML = "";
  for (let i = 0; i < accounts.length; i++) {
    const option = document.createElement("option");
    option.value = i;
    option.text = `${accounts[i].name} (${accounts[i].address}) - ${accounts[i].balance} ETH`;
    dropdown.add(option);
  }
}

// Function to send a transaction
function sendTransaction() {
  // Get the index of the "from" account and the amount to send
  const fromIndex = document.getElementById("from-account").value;
  const amount = Number(document.getElementById("amount").value);

  // Get the recipient's address
  const toAddress = document.getElementById("to-address").value;

  // Get the private key for the "from" account
  const privateKey = accounts[fromIndex].privateKey;

  // Create a new transaction object
  const tx = {
    from: accounts[fromIndex].address,
    to: toAddress,
    value: web3.utils.toWei(amount.toString(), "ether"),
    gas: 2000000,
  };

  // Sign the transaction with the private key
  web3.eth.accounts.signTransaction(tx, privateKey, function (error, signedTx) {
    if (error) {
      console.error(error);
      alert("Transaction failed");
    } else {
      // Send the signed transaction to the network
      web3.eth.sendSignedTransaction(signedTx.rawTransaction, function (error, txHash) {
        if (error) {
          console.error(error);
          alert("Transaction failed");
        } else {
          // Update the account balances and transaction history
          accounts[fromIndex].balance -= amount;
          accounts[toAddress] = accounts[toAddress] || {
            name: "New Account",
            address: toAddress,
            balance: 0,
          };
          accounts[toAddress].balance += amount;
          const transactionsTableBody = document.getElementById("transactions-table-body");
          const row = transactionsTableBody.insertRow(0);
          const fromCell = row.insertCell(0);
          const toCell = row.insertCell(1);
          const amountCell = row.insertCell(2);
          fromCell.innerHTML = accounts[fromIndex].name;
          toCell.innerHTML = toAddress;
          amountCell.innerHTML = `${amount} ETH`;
          alert("Transaction successful");
        }
      });
    }
  });
}

	  </script>
	  
  </head>
  <body>
    <h1>Crypto Wallet</h1>

    <div id="account-section">
      <h2>Account</h2>
      <label for="account-name">Account Name:</label>
      <input type="text" id="account-name" />
      <label for="account-balance">Account Balance:</label>
      <span id="account-balance">0 ETH</span>
      <button id="create-account-btn">Create Account</button>
    </div>

    <div id="send-section">
      <h2>Send Crypto</h2>
      <label for="to-address">To Address:</label>
      <input type="text" id="to-address" />
      <label for="send-amount">Send Amount:</label>
      <input type="number" id="send-amount" />
      <button id="send-btn">Send</button>
    </div>

    <div id="receive-section">
      <h2>Receive Crypto</h2>
      <label for="address">Your Address:</label>
      <input type="text" id="address" readonly />
    </div>

    <div id="history-section">
      <h2>Transaction History</h2>
      <table>
        <thead>
          <tr>
            <th>From Address</th>
            <th>To Address</th>
            <th>Amount</th>
          </tr>
        </thead>
        <tbody id="transaction-history"></tbody>
      </table>
    </div>

    <script src="crypto.js"></script>
    <script src="app.js"></script>
  </body>
</html>
