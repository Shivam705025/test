<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Jupyter Interpreter</title>
    <script src="https://unpkg.com/@jupyterlab/coreutils@latest"></script>
    <script src="https://unpkg.com/@jupyterlab/services@latest"></script>
  </head>
  <body>
    <textarea id="input"></textarea>
    <button onclick="execute()">Execute</button>
    <div id="output"></div>
    <div id="input2_container"></div>
    <script>
      var inputIndex = 1;
      var kernel;
      async function execute() {
        // Get the code from the input textarea
        var code = document.getElementById("input").value;

        // Clear the output div
        var outputDiv = document.getElementById("output");
        outputDiv.innerHTML = "";

        // Execute the code using the Jupyter kernel
        if (!kernel) {
          kernel = await startKernel();
        }
        var result = await executeCode(kernel, code);

        // Display the output in the output div
        outputDiv.innerHTML = result;

        // Create a new input box for the next input
        var input2Container = document.getElementById("input2_container");
        var input2 = document.createElement("textarea");
        input2.setAttribute("id", "input" + inputIndex);
        input2Container.appendChild(input2);
        inputIndex++;
      }

      async function startKernel() {
        // Start a new Jupyter kernel
        var baseUrl = window.location.origin;
        var response = await fetch(baseUrl + "/api/kernels", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Accept": "application/json"
          },
          body: JSON.stringify({ name: "python3" })
        });
        var kernelInfo = await response.json();
        var kernelId = kernelInfo.id;
        var wsUrl = baseUrl.replace(/^http/, "ws") + "/api/kernels/" + kernelId + "/channels";
        var ws = new WebSocket(wsUrl);
        var kernel = new JupyterKernel(ws);
        return kernel;
      }

      async function executeCode(kernel, code) {
        // Execute the code using the Jupyter kernel
        var future = kernel.requestExecute({ code: code });
        var reply = await future.done;
        var content = reply.content;
        var output = "";
        if (content.status === "ok") {
          var data = content.data;
          for (var mimeType in data) {
            var value = data[mimeType];
            switch (mimeType) {
              case "text/plain":
                output += value + "\n";
                break;
              case "image/png":
                output += "<img src=\"data:image/png;base64," + value + "\" />\n";
                break;
              case "text/html":
                output += value + "\n";
                break;
              case "application/json":
                output += JSON.stringify(value) + "\n";
                break;
              default:
                output += "[" + mimeType + "]\n" + value + "\n";
            }
          }
        } else if (content.status === "error") {
          var trace = content.traceback.join("\n");
          output = "Error: " + content.ename + "\n" + content.evalue + "\n" + trace + "\n";
        }
        return output;
      }
    </script>
  </body>
</html>
