<!DOCTYPE html>
<html>
<head>
	<title>Qiskit Compiler</title>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>
<body>
	<h1>Qiskit Compiler</h1>
	<textarea id="input" rows="10" cols="80" placeholder="Enter your Qiskit code here"></textarea>
	<button id="compile">Compile</button>
	<h2>Output:</h2>
	<pre id="output"></pre>
	<script>
		$(document).ready(function() {
			$("#compile").click(function() {
				var code = $("#input").val();
                                let encod = "MjJjNjRhZjgwMzEwNzkyY2Q5YmMyZWU3ZmVlOTAyMTkzZDgyNTM5ZDEwYjJmY2FjZTZjYzY1Y2QzYzZjYWJjYWFiNmRkMjc4OWQ3M2Q2ZDNmYjdlNjFiNDk0ZTcxNTYwMzNjNTg0ZTNiZWQzOWU3ZTM5NTQ4NTMzNTAwN2JiYmY="
				let decoded = window.atob(encod);
				var apiUrl = "https://auth.quantum-computing.ibm.com/api/users/loginWithToken";
				var apiKey = decoded;

				$.post(apiUrl, {"apiToken": apiKey})
				.done(function(data) {
					var accessToken = data.id;
					var apiUrl = "https://api.quantum-computing.ibm.com/v2/jobs";

					var request = {
						"headers": {
							"Authorization": accessToken
						},
						"data": {
							"qObject": {
								"qasm": code
							}
						}
					};

					$.post(apiUrl, request)
					.done(function(data) {
						var jobId = data.id;
						var statusUrl = apiUrl + "/" + jobId + "/status";

						var intervalId = setInterval(function() {
							$.get(statusUrl, request)
							.done(function(data) {
								var status = data.status;

								if (status == "COMPLETED") {
									var resultUrl = apiUrl + "/" + jobId + "/results";
									$.get(resultUrl, request)
									.done(function(data) {
										var result = data.result.result;
										$("#output").text(result);
									})
									.fail(function() {
										$("#output").text("Error: Could not get results");
									});

									clearInterval(intervalId);
								}
								else if (status == "ERROR") {
									$("#output").text("Error: Job failed");
									clearInterval(intervalId);
								}
							})
							.fail(function() {
								$("#output").text("Error: Could not get status");
								clearInterval(intervalId);
							});
						}, 2000);
					})
					.fail(function() {
						$("#output").text("Error: Could not submit job");
					});
				})
				.fail(function() {
					$("#output").text("Error: Could not get access token");
				});
			});
		});
	</script>
</body>
</html>
