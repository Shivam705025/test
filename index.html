<!DOCTYPE html>
<html>
<head>
	<title>Website Score</title>
	<script src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js"></script>
</head>
<body>
	<h1>Website Score:</h1>
	<p id="score">0 seconds</p>
	<button id="connect-wallet">Connect Wallet</button>
	<button id="store-score">Store Score</button>
	<p id="current-wallet"></p>
	<p id="error-message"></p>
	<h2>Top 100 Scores:</h2>
	<ul id="top-scores"></ul>

	<script>
		let provider;
		let signer;
		let scoreTokenContract;
		let walletAddress;
		let score = 0;
		
		const SCORE_TOKEN_ABI = [
  {
    "inputs": [],
    "name": "getTopScores",
    "outputs": [
      {
        "components": [
          {
            "internalType": "uint256",
            "name": "score",
            "type": "uint256"
          },
          {
            "internalType": "address",
            "name": "addr",
            "type": "address"
          }
        ],
        "internalType": "struct ScoreToken.Score[]",
        "name": "",
        "type": "tuple[]"
      }
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "uint256",
        "name": "score",
        "type": "uint256"
      }
    ],
    "name": "storeScore",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  }
];


		const updateScore = () => {
			let currentTime = new Date().getTime();
			let elapsedTime = currentTime - startTime;
			score = Math.floor(elapsedTime / 1000);
			document.getElementById("score").textContent = score + " seconds";
		};

		const connectWallet = async () => {
			if (typeof window.ethereum === "undefined") {
				document.getElementById("error-message").textContent = "Please install MetaMask to use this website.";
				return;
			}
			try {
				await window.ethereum.request({ method: "eth_requestAccounts" });
				provider = new ethers.providers.Web3Provider(window.ethereum);
				signer = provider.getSigner();
				walletAddress = await signer.getAddress();
				document.getElementById("current-wallet").textContent = "Connected to wallet address: " + walletAddress;
				scoreTokenContract = new ethers.Contract("SCORE_TOKEN_ADDRESS", SCORE_TOKEN_ABI, signer);
			} catch (err) {
				document.getElementById("error-message").textContent = err.message;
			}
		};

		const storeScore = async () => {
			if (!scoreTokenContract) {
				document.getElementById("error-message").textContent = "Please connect a wallet to store your score.";
				return;
			}
			try {
				await scoreTokenContract.storeScore(score);
				document.getElementById("error-message").textContent = "Score stored successfully.";
			} catch (err) {
				document.getElementById("error-message").textContent = err.message;
			}
		};

		const getTopScores = async () => {
			if (!scoreTokenContract) {
				document.getElementById("error-message").textContent = "Please connect a wallet to get top scores.";
				return;
			}
			try {
				const topScores = await scoreTokenContract.getTopScores();
				document.getElementById("top-scores").innerHTML = "";
				topScores.forEach((score, index) => {
					const listItem = document.createElement("li");
					listItem.textContent = (index + 1) + ". " + score.score + " seconds - " + score.address;
					document.getElementById("top-scores").appendChild(listItem);
				});
			} catch (err) {
				document.getElementById("error-message").textContent = err.message;
			}
		};

		document.getElementById("connect-wallet").addEventListener("click", connectWallet);
		document.getElementById("store-score").addEventListener("click", storeScore);

		let startTime = new Date().getTime();
		setInterval(updateScore, 1000);
		setInterval(getTopScores, 5000);
	</script>
</body>
</html>
